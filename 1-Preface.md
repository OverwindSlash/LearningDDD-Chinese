# 序
我清楚地记得我开始第一份真正的软件工程师工作的那天。我既欣喜若狂又惶恐不安。在高中时代为当地企业捣鼓软件之后，我渴望成为一名“真正的程序员”，并为国内最大的外包公司之一编写代码。

在我到那里的头几天，我的新同事们向我展示他们的工作方式（showing me the ropes）。在设置了公司的电子邮件并经历（go through）了时间追踪系统之后，我们终于进入了有趣的内容：公司的编码风格和标准。有人告诉我，"在这里，我们总是写出精心设计的代码，并使用分层架构"。我们逐一讨论了三个层的定义--数据访问层、业务逻辑层和表现层，然后接着讨论了可以应对这些层上需求的技术和框架。当时，公认的数据存储解决方案是 Microsoft SQL Server 2000，它在数据访问层使用 ADO.NET 进行集成。表现层则摇身一变成了桌面应用的 WinForms 或 Web 应用的 ASP.NET WebForms。我们在这两层上花了相当长的时间，所以当业务逻辑层一直没有得到任何关注时，我感到很困惑：

> “但是，业务逻辑层又如何呢？”<br> 
> “简单。这里是你实现业务逻辑的地方。”<br> 
> “那，业务逻辑又是什么呢？”<br>
> “哦，业务逻辑是你为了实现需求而需要的所有循环和'if-else'语句。”

那一天，我开始了寻找业务逻辑到底是什么的旅程，以及究竟应该如何在设计良好的代码中实现它。我花了三年多的时间才最终找到了答案。

答案就在 Eric Evans 的开创性著作《领域驱动设计：软件核心复杂性应对之道》中。事实证明，我并没有错。业务逻辑的确很重要：它是软件的核心！然而，不幸的是，我又花了三年时间才真正理解 Eric 分享的智慧。这本书非常艰深，即使英语是我的第三语言，但这也没什么帮助。

然而最终，一切都井然有序了，我与领域驱动设计（DDD）方法论达成了和解。我学习了 DDD 的原则和模式、建模和实现业务逻辑中错综复杂的问题，以及如何应对我正在构建的软件核心的复杂性。尽管有障碍，但这绝对是值得的。对我来说，走入领域驱动设计是一个改变职业生涯的经历。

## 我为什么写这本书
在过去的10年中，我向不同公司的同事介绍了领域驱动设计，进行了面对面的授课，并教授了在线课程。教学的角度不仅帮助我加深了知识，还让我有机会优化关于解释领域驱动设计的原则和模式的方式。

正如经常发生的那样，教学比学习更具挑战性。我是 [Eliyahu M. Goldratt](https://en.wikipedia.org/wiki/Eliyahu_M._Goldratt) 所做工作和教学的忠实粉丝。Eliyahu 曾经说过，即使是最复杂的系统，如果从正确的角度来看，本质上也是简单的。在我多年教授 DDD 的过程中，我一直在寻找一种方法论的模型，以揭示领域驱动设计本质上的简单性。

这本书是我努力的结果。它的目标是使领域驱动设计大众化；使它更容易被理解，更容易被采用。我相信 DDD 方法论绝对是非常有价值的，尤其是在设计现代软件系统时。本书将给你提供足够的工具，让你开始在日常工作中应用领域驱动设计。

## 谁应该读这本书
我相信领域驱动设计原则和模式的知识对所有级别的软件工程师都是有用的：初级、高级、资深和首席。DDD 不仅提供了用于建模和有效实现软件的工具和技术，它还阐明了软件工程中一个经常被忽视的方面：上下文。掌握了系统业务问题的知识，你在选择适当的解决方案时将会更加高效。一个没有设计不足或过度设计，且能满足业务需求和目标的解决方案。

领域驱动设计对于软件架构师来说更加重要，对于有抱负的软件架构师来说更是如此。DDD 的战略设计决策工具将帮助你将大型系统分解为组件（服务、微服务或子系统），并设计组件如何相互集成以形成系统。

最终，在本书中，我们不仅会讨论如何设计软件，还会讨论如何随着业务背景的变化一同演化设计。软件工程的这一关键方面将帮助你保持系统的设计随着时间的推移而"保持形状"，并防止其退化为一个大泥球。

## 在本书中导航
本书分为四个部分：战略设计、战术设计、实践中的 DDD，以及 DDD 与其他方法论和模式的关系。第Ⅰ部分，我们介绍了构建大规模软件设计决策的工具和技术。第Ⅱ部分，我们重点讨论代码：实现系统业务逻辑的不同方式。第Ⅲ部分讨论了在实际项目中应用 DDD 的技术和策略。第Ⅳ部分继续讨论领域驱动设计，但这次是在其他方法论和模式的背景下。

以下是你在每个章节中将会看到的内容的简短摘要：

- 第 1 章  确定了软件工程项目的背景：业务领域、既定目标以及软件如何支撑它们。
- 第 2 章  介绍了"通用语言"的概念：领域驱动设计中关于有效沟通和知识共享的实践。
- 第 3 章  讨论如何处理业务领域的复杂性，并设计系统的高级架构组件：限界上下文。
- 第 4 章  探讨了在限界上下文之间组织通信和集成的不同模式。
- 第 5 章  开始讨论业务逻辑实现模式，有两个模式可处理简单业务逻辑的情况。
- 第 6 章  从简单的业务逻辑推进到复杂的业务逻辑，并介绍了用于解决其复杂性的领域模型模式。
- 第 7 章  增加了时间的视角，并介绍了一种更高级的业务逻辑建模和实现方式：事件溯源领域模型。
- 第 8 章  将重点转移到一个更高的层次，并描述了三种结构组件的架构模式。
- 第 9 章  提供了编排系统组件工作所需的模式。
- 第 10 章  将前面几章中讨论的模式联系在一起，形成了一些简单的经验法则，从而简化了制定设计决策的过程。
- 第 11 章  从时间的角度探讨了软件设计，以及它应该如何在其生命周期内变化和演进。
- 第 12 章  介绍了事件风暴：一种有效分享知识、建立共识和设计软件的非技术型（low-tech）研讨会。
- 第 13 章  讨论了在遗留项目（brownfield projects）中引入领域驱动设计时可能面临的困难。
- 第 14 章  讨论了微服务架构风格和领域驱动设计之间的关系：它们的不同之处和互补之处。
- 第 15 章  探讨了在事件驱动架构背景下的领域驱动设计模式和工具。
- 第 16 章  将讨论从业务系统转移到了分析性数据管理系统，并探讨了领域驱动设计和数据网格之间的互动。

所有这些章节都以一些练习题结束，以加强学习。一些问题使用虚构的公司“WolfDesk”来展示领域驱动设计的各个方面。请阅读以下关于 WolfDesk 的描述，并在回答相关练习题时回到该描述。

## 示例领域：WolfDesk
WolfDesk 以服务的形式提供了一个帮助台工单管理系统。如果你的初创公司需要为客户提供支持，利用 WolfDesk 的解决方案，你可以在短时间内启动并运行此系统。

WolfDesk 采用与竞争对手不同的支付模式。它不是按用户收费，而是允许租户根据需要设置任意数量的用户，租户按每个收费周期中打开的支持工单的数量收费。

不设最低费用，且每月超过特定阈值的工单量可享受自动批量折扣。每月开单超过500张，折扣为10%；开单超过750张，折扣为20%；开单超过1,000张，折扣为30%。

为防止租户滥用商业模式，WolfDesk 的工单生命周期算法可确保自动关闭非活动工单，鼓励客户在需要进一步支持时创建新工单。此外，WolfDesk 还实现了一个欺诈检测系统，可分析信息并检测在工单中讨论不相关主题的情况。

为了帮助租户简化与支持有关的工作，WolfDesk 实现了一个 "支持自动驾驶" 功能。"支持自动驾驶" 分析新的工单并尝试从租户的工单历史记录中自动找到匹配的解决方案。该功能允许进一步减少工单的持续时间，鼓励客户为进一步的问题开立新的工单。

WolfDesk 整合了所有安全标准和措施来验证和授权租户的用户，其还允许租户使用他们现有的用户管理系统配置单点登录 (SSO)。

管理接口允许租户配置工单类别的可能值，以及租户所支持的产品列表。

为了能够只在支持人员的工作时间内将新的工单转给他们，WolfDesk 允许输入每个支持人员的轮班时间表。

由于 WolfDesk 提供的服务没有最低收费，它必须优化其基础设施以最大限度地减少新租户的入驻成本。为此，WolfDesk 利用无服务（serverless）计算，使其能够根据活动工单上的操作灵活地扩展其计算资源。

## 本书中使用的约定
本书中使用以下排版约定：

*斜体*

&emsp;&emsp;&emsp;&emsp;表示新的术语、URL、电子邮件地址、文件名和文件扩展名。
	
等宽

&emsp;&emsp;&emsp;&emsp;用于源代码列表，以及在段落中指代源代码元素，如变量或函数名称、数据库、数据类型、环境变量、语句和关键字。

&emsp;&emsp;&emsp;&emsp;<img src=images/general-note.png width=50 />&emsp;&emsp;此元素表示一般性说明。

## 使用代码示例
补充材料（代码示例、练习等）可在[https://learning-ddd.com](https://learning-ddd.com) 下载。

本书中介绍的所有代码示例都是用C#语言实现的。一般来说，你在各章中看到的代码示例是所讨论概念的展示节选。

当然，书中讨论的概念和技术并不限于C#语言或面向对象的编程方法。一切都可以关联到其他语言和其他编程范式。

因此，请随时用你喜欢的语言实现本书的示例并与我分享。我很乐意将它们添加到本书的网站中。

如果你有技术问题或使用示例代码的问题，请发送电子邮件至 [bookquestions@oreilly.com](bookquestions@oreilly.com.)。

本书旨在帮助你完成工作。一般来说，如果本书提供了示例代码，你可以在你的程序和文档中使用它。你不需要联系我们获得许可，除非你要再发行代码的绝大部分。例如，编写一个使用本书中的多个代码块的程序不需要许可。销售或分发 O'Reilly 书籍中的示例确实需要获得许可。通过引用本书和引用示例代码来回答问题不需要许可。将本书中的大量示例代码纳入你的产品文档确实需要得到许可。

我们会感谢，但通常并不要求署名。署名一般会包括标题、作者、出版商和 ISBN。例如：“学习领域驱动设计，作者 Vlad Khononov (O'Reilly)。版权所有 2022 Vladislav Khononov, 978-1-098-10013-1。”

如果你觉得你对代码示例的使用超出了合理使用或上述许可的范围，请随时与我们联系，[permissions@oreilly.com](permissions@oreilly.com)。

## O’Reilly 在线学习
<img src=images/oreilly.png width=150 />40多年来，[O'Reilly Media](http://oreilly.com/) 提供技术和商业培训、知识和洞察力，以帮助公司取得成功。

我们独有的专家和创新者网络通过书籍、文章和我们的在线学习平台分享他们的知识和专长。 O'Reilly 的在线学习平台让你可以按需访问现场培训课程、深入学习路径、交互式编码环境以及来自 O'Reilly 和其他200多家出版商的大量文本和视频。如需更多信息，请访问 [http://oreilly.com](http://oreilly.com)。

## 如何联络我们
有关本书的意见和问题请向出版商提出：

O’Reilly Media, Inc.<br>
1005 Gravenstein Highway North<br>
Sebastopol, CA 95472<br>
800-998-9938 (in the United States or Canada)<br>
707-829-0515 (international or local)<br>
707-829-0104 (fax)<br>

我们为这本书建立了一个网页，在那里我们列出了勘误表、例子和任何其他信息。你可以访问这个页面：[https://oreil.ly/lddd](https://oreil.ly/lddd)。

发送电子邮件至 [bookquestions@oreilly.com](bookquestions@oreilly.com) 可以评论或询问有关本书的技术问题。

有关我们书籍和课程的新闻和信息，请访问 [http://oreilly.com](http://oreilly.com)。

在 Facebook 上找到我们：[http://facebook.com/oreilly](http://facebook.com/oreilly)

在 Twitter 上关注我们：[http://twitter.com/oreillymedia](http://twitter.com/oreillymedia)

在 YouTube 上观看我们：[http://youtube.com/oreillymedia](http://youtube.com/oreillymedia)

## 致谢
最初，这本书的标题是 "什么是领域驱动设计？"，并在2019年以报告的形式出版。如果没有这份报告，《学习领域驱动设计》就不会有今天，我有义务感谢那些使《什么是领域驱动设计》成为可能的人。Chris Guzikowski、Ryan Shaw 和 Alicia Young。[^1]

如果没有 O'Reilly 的内容总监和多元化人才负责人 Melissa Duffield，这本书也不可能问世，她支持了这个项目并使之成为现实。谢谢你，Melissa，谢谢你的帮助。

Jill Leonard 是本书的开发编辑、项目经理和总教练。Jill 在这项工作中的作用怎么强调都不为过。Jill，非常感谢你的辛勤工作和帮助！非常感谢你让我保持动力，甚至在我考虑改名换姓躲到外国时也是如此。

非常感谢制作团队，他们使这本书不仅可写而且可读。Kristen Brown、Audrey Doyle、Kate Dullea、Robert Romano 和 Katherine Tozer。就这一点而言，我想感谢整个 O'Reilly 团队，感谢你们所做的出色工作。和你们一起工作真是美梦成真！

感谢所有我采访过和咨询过的人。Zsofia Herendi, Scott Hirleman, Trond Hjorteland, Mark Lisker, Chris Richardson, Vaughn Vernon, and Ivan Zakrevsky。感谢你们的智慧，感谢你们在我需要帮助的时候出现在我的身边!

特别感谢审稿人团队，他们通读了早期的草稿并帮助我塑造了本书最终的样子：Julie Lerman、Ruth Malan、Diana Montalion、Andrew Padilla、Rodion Promyshlennikov、Viktor Pshenitsyn、Alexei Torunov、Nick Tune、Vasiliy Vasilyuk 和 Rebecca Wirfs-Brock。你们的支持、反馈和批评帮助很大。谢谢！

我还要感谢 Kenny Baas-Schwegler、Alberto Brandolini、Eric Evans、Marco Heimeshoff、Paul Rayner、Mathias Verraes，以及其他了不起的领域驱动设计社区成员。你们知道你们是谁。你们是我的老师和导师。感谢你们在社交媒体、博客和会议上分享你们的知识!

我最要感谢的是我亲爱的妻子 Vera，她总是支持我的疯狂项目，并努力保护我不被那些可能分散我写作精力的事情所影响。我保证最终会把地下室清理干净。这将很快发生

最后，我想把这本书献给我们敬爱的 Galina Ivanovna Tyumentseva，她在这个项目中给予了我很大的支持，在本书写作期间我们不幸失去了她。我们会永远记住你。

[^1]: 每当我提到一群人时，名单都是按姓氏字母顺序排列的。