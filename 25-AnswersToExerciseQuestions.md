## 附录 B
# 练习题答案

## 第 1 章

1. D：B 和 C。只有核心子域才能提供竞争优势，使公司在同行业中脱颖而出。
2. B：通用。通用子域很复杂，但不会带来任何竞争优势。因此，最好使用经过实战验证的现有解决方案。
3. A：核心。核心子域预计将是最不稳定的，因为这些是公司旨在提供新解决方案的领域，并且通常需要相当多的交互才能找到最优化的解决方案。
4. WolfDesk 的业务领域是服务台管理系统。
5. 我们可以确定以下核心子域，使 WolfDesk 能够从竞争对手中脱颖而出并支持其商业模式：<br>
a. 工单生命周期管理算法，旨在关闭工单，从而鼓励用户打开新工单<br>
b. 防止滥用其商业模式的欺诈检测系统<br>
c. 支持自动驾驶舱，既可以减轻租户的支持专员的工作，又可以进一步缩短工单的使用寿命<br>
6. 从对公司的描述中可以识别以下支撑子域：<br>
a. 租户的工单类别管理<br>
b. 租户的产品管理，客户可以就这些产品提出支持工单<br>
c. 租户支持专员工作时间表的录入<br>
7. 从对公司的描述中可以识别以下通用子域：<br>
a. 认证和授权用户的 "工业标准" 实现<br>
b. 使用外部供应商进行认证和授权（SSO）<br>
c. 公司利用无服务的计算基础设施，以确保弹性扩展，并尽量减少新租户入驻的计算成本。<br>

## 第 2 章

1. D：项目的所有利益相关者都应该贡献他们对业务领域的知识和理解。
2. D：所有与项目相关的沟通都应该使用通用语言。软件的源代码也应该“说”它的通用语言。
3. WolfDesk 的用户是 *租户*。要开始使用该系统，租户需要完成一个快速的 *入驻* 流程。公司的收费模式基于在 *收费期间* 打开的 *工单* 数量。*工单生命周期* 管理算法可确保自动关闭 *非活动工单*。WolfDesk 的 *欺诈检测* 算法可防止租户滥用其商业模式。*支持服务自动驾驶舱* 功能会尝试自动为新工单寻找解决方案。*工单* 属于一个支持服务 *类别*，并与租户提供支持的 *产品* 相关联。*支持专员* 只能在他们的 *工作时间* 内处理工单，这由他们的 *轮班时间表* 定义。

## 第 3 章

1. B. 限界上下文是被设计出来的，而子域是被发现的。
2. D. 以上所有。限界上下文是模型的边界，模型仅适用于其限界上下文。限界上下文在独立的项目/解决方案中实现，因此允许每个限界上下文都有自己的开发生命周期。最后，一个限界上下文应该仅由一个开发团队来实现，因此，它也是一个所有权边界。
3. D. 视情况而定。没有对于所有项目和案例大小都完美的限界上下文。不同的因素，如模型、组织约束和非功能性需求，都会影响到限界上下文的最佳范围。
4. D. B 和 C 是正确的。一个限界上下文应该仅由一个团队所拥有。同一团队可以同时拥有多个限界上下文。
5. 可以肯定的是，实现工单生命周期的操作模型将不同于用于欺诈检测和支持自动驾驶舱功能的模型。欺诈检测算法通常需要更多面向分析的建模，而自动驾驶舱功能可能会使用针对机器学习算法优化的模型。

## 第 4 章

1. D. 另谋他路。该模式需要在多个限界上下文中重复实现功能。应不惜一切代价避免复制复杂的、易变的和业务关键的业务逻辑。
2. A. 核心子域。核心子域最有可能利用防腐层来保护自己免受上游服务暴露的无效模型的影响，或者不得不包含应对上游公开接口的频繁更改。
3. A. 核心子域。核心子域最有可能实现开放主机服务。将其实现模型与公开接口（发布语言）解耦，可以更方便地演进核心子域的模型，而不会影响其下游消费者。
4. B. 共享内核。共享内核模式是限界上下文单一团队所有权规则的一个例外。它定义了共享模型的一小部分，并且可以由多个限界上下文同时演化。模型的共享部分应始终保持尽可能小。

## 第 5 章

1. C. 这两种模式都不能用来实现核心子域。事务脚本和活动记录都适用于简单的业务逻辑，而核心子域涉及更复杂的业务逻辑。
2. D. 所有以上的问题都有可能发生。<br>
a. 如果在第 6 行之后执行失败，调用者重试操作，并且 FindLeastBusyAgent 方法选择了相同的专员，则专员的 ActiveTickets 计数器将增加 1 以上。<br>
b. 如果在第 6 行之后执行失败但调用者 *没有* 重试该操作，则计数器将增加，而工单本身将不会被创建。<br>
c. 如果在第 12 行之后执行失败，则工单被创建和分配，但第 14 行的通知不会被发送。<br>
3. 如果在第 12 行之后执行失败并且调用者重试操作并成功，则相同的工单将被持久化并分配两次。
4. WolfDesk 的所有支撑子域都非常适合作为事务脚本或活动记录来实现，因为它们的业务逻辑相对简单：<br>
a. 租户的工单类别的管理。<br>
b. 管理租户的产品，客户可以就这些产品提出支持工单。<br>
c. 租户支持专员的工作时间表的录入。<br>

## 第 6 章

1. C. 值对象是不可变的。（此外，它们可以同时包含数据和行为。）
2. B. 只要业务领域的数据一致性需求不受影响，聚合就应该被设计得尽可能小。
3. B. 确保正确的事务边界。
4. D. A 和 C。
5. B. 聚合封装了它的所有业务逻辑，但操作活动记录的业务逻辑可以位于其边界之外。

## 第 7 章

1. A. 领域事件使用值对象来描述业务领域中所发生的事情。
2. C. 可以投影多个状态表征，并且你可以在未来随时添加其他投影。
3. D. B 和 C 都正确。
4. 工单生命周期算法是作为事件溯源领域模型实现的一个很好的候选者。为所有的状态转换生成领域事件，可以更方便地投影额外状态表征，这些状态表征为欺诈检测算法和支持自动驾驶舱功能而优化。

## 第 8 章

1. D. A 和 C。
2. D. B 和 C。
3. C. 基础设施层
4. E. A 和 D。
5. 使用 CQRS 模式投射的多个模型并不与限界上下文作为模型边界的要求相矛盾，因为只有一个模型被定义为真相的来源并用于更改聚合的状态。

## 第 9 章

1. D. B 和 C。
2. B. 可靠地发布消息。
3. 发件箱模式可用于实现外部组件的异步执行。例如，它可用于发送电子邮件消息。
4. E. A 和 D 是正确的。

## 第 10 章

1. 事件溯源领域模型、CQRS 架构和侧重于单元测试的测试策略。
2. 可以将轮班建模为活动记录，以分层架构模式工作。测试策略应该主要关注集成测试。
3. 业务逻辑可以作为事务脚本实现，以分层架构组织。从测试的角度来看，值得专注于端到端测试，验证完整的集成流程。

## 第 11 章

1. A. 从合作关系变为客户-供应商关系（遵奉者、防腐层或开放主机服务）。随着组织的发展，团队以临时方式集成限界上下文变得更具挑战性。因此，组织会转而采用更正式的整合模式。
2. D. A 和 B。A 是正确的，是因为当复制成本低于协作开销时，限界上下文就会采取另谋他路模式。C 是不正确的，因为复制核心子域的实现是一个糟糕的主意。因此，B 是正确的，因为另谋他路模式可用于支撑子域和通用子域。
3. D. B 和 C。
4. F. A 和 C。
5. 在达到一定的增长水平后，WolfDesk 可以跟随亚马逊的脚步并实施自己的计算平台，以进一步优化其弹性扩展的能力并优化其基础设施成本。

## 第 12 章

1. D：对你想探索的业务领域有了解的所有利益相关者。
2. F：所有的答案都是推进事件风暴会议的合理理由。
3. E：所有的答案都是事件风暴会议的可能产物。你期望得到的产物取决于你推进会议的最初目的。

## 第 13 章

1. B. 分析组织的业务领域及其战略。
2. D. A 和 B。
3. C. A 和 B。
4. 一个聚合如果具有限界上下文的边界，那么所有限界上下文中的数据就会成为一个大事务的一部分。这种方法的性能问题也可能从一开始就很明显。一旦发生这种情况，事务边界就将会被打破。

## 第 14 章

1. A. 所有的微服务都是限界上下文。（但并非所有限界上下文都是微服务。）
2. D. 业务领域的知识及其复杂性暴露在服务的边界上，并由其公开接口反映。
3. C. 介于限界上下文（最宽）和微服务（最窄）之间的边界。
4. D. 该决定取决于业务领域。

## 第 15 章

1. D. A 和 B 是正确的。
2. B. 事件携带状态迁移。
3. A. 开放主机服务。
4. B. S2 应该发布公开事件通知，通知 S1 发出同步请求以获取最新信息。

## 第 16 章

1. D. A 和 C 是正确的。
2. B. 开放主机服务。开放主机服务公开的一种发布语言可以是针对分析处理优化的 OLAP 数据。
3. C. CQRS。可以利用 CQRS 模式从业务模型中生成 OLAP 模型的投影。
4. A. 限界上下文